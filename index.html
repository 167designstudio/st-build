<!doctype html>
<html lang="ru"><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>St.Build — Home 01</title>
<link rel="icon" type="image/svg+xml" href="img/favicon.svg">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&amp;display=swap" rel="stylesheet">

<style>
  :root{
    --container-pad: 20px;
    --max-width: 1512px;
    --gap: 20px;
    --accent: #063BFF;
    --text: #111;
    --red: #D33;
    --track: #eee;

    --logo-width: 102px;
    --logo-height: 14px;
    --home-width: 66px;
    --home-height: 14px;

    --main-w-desktop: 440px;
    --main-h-desktop: 540px;
    --main-w-mobile: 260px;
    --main-h-mobile: 300px;

    --thumb-w: 260px;
    --thumb-h: 120px;

    --font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Helvetica Neue";
    --font-size: 12px;
    --h1-size: 24px;
  }

  *{ box-sizing: border-box; }
  html,body{ height:100%; margin:0; padding:0; overflow-x:hidden; }
  body{
    font-family: var(--font-family);
    color: var(--text);
    background: #fff;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    font-size: var(--font-size);
    line-height: 1.4;
  }

  .container{
    max-width: var(--max-width);
    margin: 0 auto;
    padding-left: var(--container-pad);
    padding-right: var(--container-pad);
    padding-top: 24px;
    padding-bottom: 24px;
    width: 100%;
    box-sizing: border-box;
    overflow: hidden;
  }

  header{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom: var(--gap); }
  #logoImg{ width: var(--logo-width); height: var(--logo-height); object-fit:contain; display:block; }
  #houseImg{ width: var(--home-width); height: var(--home-height); object-fit:contain; display:block; }

  .main{
    display:grid;
    grid-template-columns: 1fr 420px;
    gap: var(--gap);
    align-items:start;
    width:100%;
  }
  @media (max-width:1100px){ .main{ grid-template-columns: 1fr; } }

  .col-left{ min-width:0; }
  .col-right{ min-width:0; display:flex; flex-direction:column; gap:var(--gap); }

  .btn{
    font-family: var(--font-family);
    font-size: var(--font-size);
    font-weight:400;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    gap:8px;
    padding:10px 14px;
    border:none;
    background:#f3f3f3;
    color:var(--accent);
    text-decoration:none;
    cursor:pointer;
    width:100%;
    box-sizing:border-box;
    position:relative;
  }
  .btn.primary{ background:var(--accent); color:#fff; }
  .btn.red{ background:transparent; color:var(--red); }

  /* icon inside button — fixed height 12px */
  .btn .icon{ height:16px; width:auto; display:inline-block; margin-right:0px; vertical-align:middle; }

  .slider-wrap{ position: relative; width:100%; }
  .slider{
    display:flex;
    gap: var(--gap);
    overflow-x:auto;
    scroll-behavior:smooth;
    padding: 0;
    margin: 0;
    align-items:center;
    scroll-snap-type: x mandatory;
    -webkit-overflow-scrolling: touch;
    max-width:100%;
    min-width: 0;
  }
  .slider::-webkit-scrollbar{ display:none; }

  .slide{ flex: 0 0 auto; scroll-snap-align:center; background:#000; overflow:hidden; position:relative; border-radius:0; min-width:0; }
  .img-wrap{ position:relative; width:100%; height:100%; }
  .img-wrap img{ position:absolute; inset:0; width:100%; height:100%; object-fit:cover; display:block; transition:opacity .22s ease; }

  #slider1 .slide{ width: var(--main-w-desktop); height: var(--main-h-desktop); }
  @media (max-width:420px){ #slider1 .slide{ width: var(--main-w-mobile); height: var(--main-h-mobile); } }

  #thumbs .slide{ width: var(--thumb-w); height: var(--thumb-h); }
  @media (max-width:420px){ #thumbs .slide{ width: calc(var(--thumb-w)); height: calc(var(--thumb-h)); } }

  .day-img{ opacity:1; z-index:2; } .night-img{ opacity:0; z-index:1; }
  #slider1.night .day-img{ opacity:0; } #slider1.night .night-img{ opacity:1; }

  .day-evening-switch{ position:absolute; top:14px; left:14px; display:inline-flex; gap:8px; z-index:40; }
  .day-evening-switch button{ display:inline-flex; align-items:center; justify-content:center; gap:8px; padding:8px 10px; border:none; background:#000; cursor:pointer; font-family:var(--font-family); font-size:var(--font-size); color:#fff; transition: background .18s ease; }
  .day-evening-switch button img{ width:16px; height:16px; transition:filter .18s ease; filter: invert(1) brightness(2); }
  .day-evening-switch button.active{ background:#fff; color:#000; }
  .day-evening-switch button.active img{ filter: brightness(0); }

  .edge-zone{ position:absolute; top:0; bottom:0; width:20%; z-index:30; }
  .edge-zone.left{ left:0; } .edge-zone.right{ right:0; }

  .progress-wrap{ margin-top:10px; }
  .progress-track{ height:4px; background:var(--track); border-radius:999px; overflow:hidden; }
  .progress-bar{ height:100%; width:0%; background:var(--text); transition: width .12s linear; }

  h1{ font-family:var(--font-family); font-weight:300; font-size:var(--h1-size); letter-spacing:-0.04em; margin:0 0 8px 0; }
  .lead{ font-size:var(--font-size); color:#333; margin:0 0 20px 0; line-height:1.5; }
  .signature{ font-size:var(--font-size); color:var(--text); margin-top:12px; }

  /* tiny invisible thumbnail used to trigger Quick Look overlay on iOS */
  .ql-thumb{
    width:1px;
    height:1px;
    opacity:0;
    position:absolute;
    left:0;
    top:0;
    pointer-events:none;
  }
</style>
</head>
<body>
  <div class="container">
    <header>
      <div class="header-left"><img id="logoImg" src="img/SB_logo.svg" alt="St.Build"></div>
      <div class="header-right"><img id="houseImg" src="img/Home_logo.svg" alt="Home 01"></div>
    </header>

    <main class="main">
      <section class="col-left">
        <div class="slider-wrap" id="sliderWrap1">
          <div class="day-evening-switch" aria-label="Day Evening">
            <button class="day-btn" type="button" aria-pressed="false"><img src="img/icon_day.svg" alt="">Day</button>
            <button class="evening-btn active" type="button" aria-pressed="true"><img src="img/icon_eve.svg" alt="">Evening</button>
          </div>

          <div class="slider night" id="slider1" tabindex="0" aria-label="Main slider">
            <div class="slide" tabindex="-1"><div class="img-wrap"><img class="day-img" src="img/render/S1_day_01.jpg" alt=""><img class="night-img" src="img/render/S1_night_01.jpg" alt=""></div></div>
            <div class="slide" tabindex="-1"><div class="img-wrap"><img class="day-img" src="img/render/S1_day_02.jpg" alt=""><img class="night-img" src="img/render/S1_night_02.jpg" alt=""></div></div>
            <div class="slide" tabindex="-1"><div class="img-wrap"><img class="day-img" src="img/render/S1_day_03.jpg" alt=""><img class="night-img" src="img/render/S1_night_03.jpg" alt=""></div></div>
            <div class="slide" tabindex="-1"><div class="img-wrap"><img class="day-img" src="img/render/S1_day_04.jpg" alt=""><img class="night-img" src="img/render/S1_night_04.jpg" alt=""></div></div>
            <div class="slide" tabindex="-1"><div class="img-wrap"><img class="day-img" src="img/render/S1_day_05.jpg" alt=""><img class="night-img" src="img/render/S1_night_05.jpg" alt=""></div></div>

            <div class="edge-zone left" aria-hidden="true"></div>
            <div class="edge-zone right" aria-hidden="true"></div>
          </div>

          <div class="progress-wrap"><div class="progress-track"><div class="progress-bar" id="progress1" style="width: 22.8155%;"></div></div></div>
        </div>
      </section>

      <aside class="col-right">
        <h1>Look at Home 01 in real life</h1>
        <p class="lead">You can explore Home 01 in full scale right on your property — place it on your land, move it around, step inside, and experience what it feels like in real life. No app downloads needed — it works instantly with just one tap on iOS and Android.</p>

        <!-- Placeholder container: будет заменён функцией insertARLink() на 2 кнопки на мобильных -->
        <div id="arCta">
          <a href="#" class="btn primary"><img class="icon" src="img/tbl.svg" alt="">View in AR</a>
        </div>

        <button class="btn red" id="openOnPhone" style="display: none;">● Open this page on your phone</button>

        <p class="lead">For the best augmented reality experience, open this page in Safari on iOS or Google Chrome on Android.</p>

        <div class="slider-wrap" id="thumbsWrap">
          <div class="slider" id="thumbs" tabindex="0" aria-label="Detail slider">
            <div class="slide" tabindex="-1"><div class="img-wrap"><img src="img/render/S2_01.jpg" alt=""></div></div>
            <div class="slide" tabindex="-1"><div class="img-wrap"><img src="img/render/S2_02.jpg" alt=""></div></div>
            <div class="slide" tabindex="-1"><div class="img-wrap"><img src="img/render/S2_03.jpg" alt=""></div></div>

            <div class="edge-zone left" aria-hidden="true"></div>
            <div class="edge-zone right" aria-hidden="true"></div>
          </div>

          <div class="progress-wrap"><div class="progress-track"><div class="progress-bar" id="progress2" style="width: 0%;"></div></div></div>
        </div>

        <div class="signature">While creating this augmented reality demo page, I couldn’t just use any random house model for the demonstration. I’m used to approaching everything I do with attention to detail — so I designed and modeled the house myself, and created renders for a more immersive experience.<br><br>@mysaintdrafts</div>
      </aside>
    </main>
  </div>

<script>
  const q = (s,r=document)=>r.querySelector(s);
  const qa = (s,r=document)=>Array.from(r.querySelectorAll(s));

  const mainSlider = q('#slider1');
  const thumbs = q('#thumbs');
  const dayBtn = q('.day-btn');
  const eveBtn = q('.evening-btn');

  function setMode(mode){
    if(mode === 'night'){
      mainSlider.classList.add('night');
      eveBtn.classList.add('active'); dayBtn.classList.remove('active');
      eveBtn.setAttribute('aria-pressed','true'); dayBtn.setAttribute('aria-pressed','false');
    } else {
      mainSlider.classList.remove('night');
      dayBtn.classList.add('active'); eveBtn.classList.remove('active');
      dayBtn.setAttribute('aria-pressed','true'); eveBtn.setAttribute('aria-pressed','false');
    }
  }
  dayBtn.addEventListener('click', ()=> setMode('day'));
  eveBtn.addEventListener('click', ()=> setMode('night'));

  function attachProgress(slider, bar){
    function update(){
      const max = slider.scrollWidth - slider.clientWidth;
      const pct = max > 0 ? (slider.scrollLeft / max) * 100 : 0;
      bar.style.width = pct + '%';
    }
    slider.addEventListener('scroll', update, {passive:true});
    window.addEventListener('resize', update);
    update();
  }
  attachProgress(mainSlider, q('#progress1'));
  attachProgress(thumbs, q('#progress2'));

  function slides(sl){ return qa('.slide', sl); }
  function indexClosestToCenter(sl){
    const arr = slides(sl);
    if(!arr.length) return 0;
    const rect = sl.getBoundingClientRect();
    const center = rect.left + rect.width/2;
    let best = 0, bestDist = Infinity;
    arr.forEach((el,i)=>{
      const r = el.getBoundingClientRect();
      const c = r.left + r.width/2;
      const d = Math.abs(c - center);
      if(d < bestDist){ best = i; bestDist = d; }
    });
    return best;
  }

  function centerSlide(sl, idx){
    const arr = slides(sl);
    if(!arr.length) return;
    idx = Math.max(0, Math.min(idx, arr.length - 1));
    const el = arr[idx];
    const elOffset = el.offsetLeft;
    const elWidth = el.offsetWidth;
    const containerWidth = sl.clientWidth;
    const targetScrollLeft = elOffset - (containerWidth / 2) + (elWidth / 2);
    sl.scrollTo({ left: Math.max(0, Math.round(targetScrollLeft)), behavior: 'smooth' });
  }

  // ===== исправленная функция enableEdgePaging (вставлена сюда) =====
  function enableEdgePaging(sl){
    const left = sl.querySelector('.edge-zone.left');
    const right = sl.querySelector('.edge-zone.right');

    function next(){
      centerSlide(sl, Math.min(indexClosestToCenter(sl) + 1, slides(sl).length - 1));
    }
    function prev(){
      centerSlide(sl, Math.max(indexClosestToCenter(sl) - 1, 0));
    }

    if (left) left.addEventListener('click', prev);
    if (right) right.addEventListener('click', next);

    // Клик по слайдеру — листаем при нажатии на край
    sl.addEventListener('click', function(ev){
      // игнорируем клики по переключателю Day/Evening
      if (ev.target.closest('.day-evening-switch')) return;

      const rect = sl.getBoundingClientRect();
      const x = ev.clientX - rect.left;
      const w = rect.width;

      const threshold = Math.max(60, Math.min(180, Math.round(w * 0.18)));

      if (x > w - threshold) {
        next();
      } else if (x < threshold) {
        prev();
      }
    }, { passive: true });

    // клавиатурная навигация
    sl.addEventListener('keydown', function(e){
      if (e.key === 'ArrowRight'){ e.preventDefault(); next(); }
      if (e.key === 'ArrowLeft'){ e.preventDefault(); prev(); }
    });
  }
  // ===== конец правки =====

  enableEdgePaging(mainSlider);
  enableEdgePaging(thumbs);

  const arCta = q('#arCta'), openOnPhone = q('#openOnPhone');
  function updateCta(){ if(window.innerWidth <= 1100){ arCta.style.display='block'; openOnPhone.style.display='none'; } else { arCta.style.display='none'; openOnPhone.style.display='inline-flex'; } }

  // Insert AR anchor based on userAgent — using your implementation logic but WITHOUT document.write
  function insertARLink(){
    const ua = navigator.userAgent.toLowerCase();
    const container = q('#arCta');
    if(!container) return;

    // only apply on mobile widths
    if(window.innerWidth > 1100) return;

    let html = '';
    if (/iphone|ipad|ipod/.test(ua)) {
      html = `<a rel="ar" href="ar/ar-ios-s.usdz" class="btn primary"><img class="icon" src="img/tbl.svg" alt="">View on your table<img class="ql-thumb" src="img/render/S1_day_01.jpg" alt=""></a><div style="height:12px"></div><a rel="ar" href="ar/ar-ios.usdz" class="btn outline"><img class="icon" src="img/tree.svg" alt="">Real size<img class="ql-thumb" src="img/render/S1_day_01.jpg" alt=""></a>`;
    } else if (/android/.test(ua)) {
      html = `<a href="intent://arvr.google.com/scene-viewer/1.0?file=https://167designstudio.github.io/st-build/ar/ar-and-s.glb#Intent;scheme=https;package=com.google.android.googlequicksearchbox;action=android.intent.action.VIEW;end;" class="btn primary"><img class="icon" src="img/tbl.svg" alt="">View on your table</a><div style="height:12px"></div><a href="intent://arvr.google.com/scene-viewer/1.0?file=https://167designstudio.github.io/st-build/ar/ar-and.glb#Intent;scheme=https;package=com.google.android.googlequicksearchbox;action=android.intent.action.VIEW;end;" class="btn outline"><img class="icon" src="img/tree.svg" alt="">Real size</a>`;
    } else {
      html = `<a href="#" class="btn primary"><img class="icon" src="img/tbl.svg" alt="">View on your table</a><div style="height:12px"></div><a href="#" class="btn outline"><img class="icon" src="img/tree.svg" alt="">Real size</a>`;
    }

    const wrapper = document.createElement('div');
    wrapper.innerHTML = html;
    const anchor = wrapper.firstElementChild;
    if(anchor) container.replaceWith(wrapper);
  }

  window.addEventListener('load', ()=>{
    updateCta();
    insertARLink();
    setTimeout(()=>{ centerSlide(mainSlider, 0); centerSlide(thumbs, 0); }, 120);
  });
  window.addEventListener('resize', ()=>{
    updateCta();
    insertARLink();
    centerSlide(mainSlider, indexClosestToCenter(mainSlider));
    centerSlide(thumbs, indexClosestToCenter(thumbs));
  });

  qa('.slide').forEach(s => s.setAttribute('tabindex','-1'));
</script>
</body></html>